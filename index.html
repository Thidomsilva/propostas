<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciador de Propostas Sagacy</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/dashboard.css">
</head>
<body>
    <div class="App">
        <!-- Loading -->
        <div id="loading" class="loading-container">
            <div class="loading-bar"></div>
            <div class="loading-text">Autoridade em Expandir Negócios</div>
        </div>

        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-container">
                    <div class="logo-text">GERENCIADOR DE PROPOSTAS SAGACY</div>
                </div>
                <div class="header-info">
                    <span>Sistema de Propostas Comerciais</span>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Navigation -->
            <nav class="navigation">
                <div class="nav-buttons">
                    <button class="nav-button active" onclick="showFormulario()">
                        📝 Nova Solicitação
                    </button>
                    <button class="nav-button" onclick="showPainel()">
                        📋 Painel de Acompanhamento
                    </button>
                    <button class="nav-button" onclick="showDashboard()">
                        📊 Dashboard
                    </button>
                </div>
            </nav>
            
            <!-- Formulário -->
            <div id="formulario" class="page">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Nova Solicitação</h2>
                        <p class="card-subtitle">Preencha o formulário para criar uma nova solicitação</p>
                    </div>
                    
                    <form id="form-solicitacao">
                        <div class="form-group">
                            <label for="cliente">Cliente *</label>
                            <input type="text" class="form-control" id="cliente" name="cliente" required>
                        </div>

                        <div class="form-group">
                            <label for="servico">Projeto *</label>
                            <select class="form-control" id="servico" name="servico" required>
                                <option value="">Selecione o projeto...</option>
                                <option value="50 em 30">50 em 30</option>
                                <option value="Auditoria Externa">Auditoria Externa</option>
                                <option value="Auditoria Interna">Auditoria Interna</option>
                                <option value="Business 360">Business 360</option>
                                <option value="Business Intelligence (BI)">Business Intelligence (BI)</option>
                                <option value="Business Plan">Business Plan</option>
                                <option value="Business Plan - Offshore">Business Plan - Offshore</option>
                                <option value="Capacitação de Líderes">Capacitação de Líderes</option>
                                <option value="Capacitação in Company">Capacitação in Company</option>
                                <option value="Coaching">Coaching</option>
                                <option value="Consultoria">Consultoria</option>
                                <option value="Consultoria Financeira">Consultoria Financeira</option>
                                <option value="Consultoria Jurídica">Consultoria Jurídica</option>
                                <option value="Consultoria RH">Consultoria RH</option>
                                <option value="Consultoria Tecnologia">Consultoria Tecnologia</option>
                                <option value="Desenvolvimento Web">Desenvolvimento Web</option>
                                <option value="Diagnóstico">Diagnóstico</option>
                                <option value="Estruturação">Estruturação</option>
                                <option value="Geração de Faturamento">Geração de Faturamento</option>
                                <option value="Gestão de Vendas">Gestão de Vendas</option>
                                <option value="Governança">Governança</option>
                                <option value="Growth Hacking">Growth Hacking</option>
                                <option value="Mentoria">Mentoria</option>
                                <option value="Palestra">Palestra</option>
                                <option value="People Management">People Management</option>
                                <option value="Pitch Deck">Pitch Deck</option>
                                <option value="Planejamento Estratégico">Planejamento Estratégico</option>
                                <option value="Planejamento Tributário">Planejamento Tributário</option>
                                <option value="Precificação">Precificação</option>
                                <option value="Projetos Especiais">Projetos Especiais</option>
                                <option value="Reestruturação">Reestruturação</option>
                                <option value="Startup">Startup</option>
                                <option value="Sucesso do Cliente">Sucesso do Cliente</option>
                                <option value="Valuation">Valuation</option>
                                <option value="Vendas">Vendas</option>
                                <option value="Workshop">Workshop</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="solicitante">Solicitante *</label>
                            <select class="form-control" id="solicitante" name="solicitante" required onchange="toggleOutroSolicitante()">
                                <option value="">Selecione o solicitante...</option>
                                <option value="Da Silva">Da Silva</option>
                                <option value="Edson">Edson</option>
                                <option value="Marcos">Marcos</option>
                                <option value="Matoso">Matoso</option>
                                <option value="Milena">Milena</option>
                                <option value="Thiago">Thiago</option>
                                <option value="Victor">Victor</option>
                                <option value="William">William</option>
                                <option value="Outros (especificar)">Outros (especificar)</option>
                            </select>
                        </div>

                        <div class="form-group" id="campo-outro-solicitante" style="display: none;">
                            <label for="outro-solicitante">Nome do Solicitante *</label>
                            <input type="text" class="form-control" id="outro-solicitante" name="outro-solicitante">
                        </div>

                        <div class="form-group">
                            <label for="descricao">Descrição do Projeto *</label>
                            <textarea class="form-control" id="descricao" name="descricao" rows="4" required></textarea>
                        </div>

                        <div class="form-group">
                            <label for="prazo">Prazo Desejado</label>
                            <input type="date" class="form-control" id="prazo" name="prazo">
                        </div>

                        <!-- Notificação sobre e-mail -->
                        <div class="email-notification">
                            <div class="email-notification-content">
                                <span class="email-icon">📧</span>
                                <div class="email-text">
                                    <strong>Notificação Automática</strong>
                                    <p>Ao enviar esta solicitação, um e-mail será enviado automaticamente para <strong>thiago@sagacy.com.br</strong> com todos os detalhes.</p>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <span id="btn-text">Enviar Solicitação</span>
                                <span id="btn-loading" class="d-none">Enviando...</span>
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="limparFormulario()">
                                Limpar
                            </button>
                            <button type="button" class="btn btn-info" onclick="testarNavegacaoDireta()">
                                🧪 Testar Navegação
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard" class="page d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">🏆 Dashboard com Ranking</h2>
                        <p class="card-subtitle">Ranking de solicitantes e estatísticas</p>
                        <div class="last-refresh" id="last-refresh">Sistema inicializado</div>
                    </div>
                    
                    <!-- KPIs -->
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-icon">📈</div>
                            <div class="kpi-content">
                                <div class="kpi-number" id="kpi-mes">0</div>
                                <div class="kpi-label">Solicitações este Mês</div>
                                <div class="kpi-trend" id="kpi-mes-trend">-</div>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-icon">⏱️</div>
                            <div class="kpi-content">
                                <div class="kpi-number" id="kpi-tempo">-</div>
                                <div class="kpi-label">Tempo Médio</div>
                                <div class="kpi-trend" id="kpi-tempo-trend">-</div>
                            </div>
                        </div>
                        
                        <div class="kpi-card">
                            <div class="kpi-icon">✅</div>
                            <div class="kpi-content">
                                <div class="kpi-number" id="kpi-taxa">0%</div>
                                <div class="kpi-label">Taxa de Finalização</div>
                                <div class="kpi-trend" id="kpi-taxa-trend">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ranking -->
                    <div class="performance-grid">
                        <div class="performance-card">
                            <h3>🏆 TOP SOLICITANTES</h3>
                            <div class="ranking-list" id="ranking-solicitantes">
                                <div class="loading-message">Carregando ranking...</div>
                            </div>
                        </div>
                        
                        <div class="performance-card">
                            <h3>📊 Serviços Mais Solicitados</h3>
                            <div class="services-chart" id="services-chart">
                                <div class="loading-message">Carregando...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Status -->
                    <div class="performance-grid">
                        <div class="performance-card">
                            <h3>📊 Status das Solicitações</h3>
                            <div class="status-chart">
                                <div class="status-item">
                                    <div class="status-label">Em Andamento</div>
                                    <div class="status-bar-container">
                                        <div class="status-bar status-andamento" id="bar-andamento"></div>
                                    </div>
                                    <div class="status-percent" id="percent-andamento">0%</div>
                                </div>
                                <div class="status-item">
                                    <div class="status-label">Finalizado</div>
                                    <div class="status-bar-container">
                                        <div class="status-bar status-finalizado" id="bar-finalizado"></div>
                                    </div>
                                    <div class="status-percent" id="percent-finalizado">0%</div>
                                </div>
                                <div class="status-item">
                                    <div class="status-label">Aberto</div>
                                    <div class="status-bar-container">
                                        <div class="status-bar status-aberto" id="bar-aberto"></div>
                                    </div>
                                    <div class="status-percent" id="percent-aberto">0%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="performance-card">
                            <h3>📈 Volume Mensal</h3>
                            <div class="monthly-chart" id="monthly-chart">
                                <div class="loading-message">Carregando...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Controles -->
                    <div class="dashboard-controls">
                        <button class="btn btn-primary" onclick="loadDashboardData()">
                            🔄 Atualizar Dashboard
                        </button>
                        <button class="btn btn-secondary" onclick="alert('Funcionalidade em desenvolvimento')">
                            📊 Exportar Relatório
                        </button>
                    </div>
                </div>
            </div>

            <!-- Painel -->
            <div id="painel" class="page d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Painel de Acompanhamento</h2>
                        <p class="card-subtitle">Visualize e gerencie todas as solicitações</p>
                    </div>
                    
                    <div class="painel-controls">
                        <button class="btn btn-primary" onclick="loadSolicitacoes()">
                            🔄 Atualizar Lista
                        </button>
                    </div>
                    
                    <div id="lista-solicitacoes" class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Cliente</th>
                                    <th>Projeto</th>
                                    <th>Solicitante</th>
                                    <th>Status</th>
                                    <th>Data</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tabela-solicitacoes">
                                <tr>
                                    <td colspan="7" class="text-center">
                                        Carregue os dados clicando em "Atualizar Lista"
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <p>Desenvolvido por: thiago@sagacy.com.br</p>
            </div>
        </footer>

        <!-- Toast Container -->
        <div id="toast-container" class="toast-container"></div>

        <!-- Debug Info -->
        <div id="debug-info" class="debug-info">
            <div>Debug Mode: ON</div>
            <div id="debug-last-action">-</div>
            <div id="debug-api-status">API: Não testada</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./js/main.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/dashboard.js"></script>
    <script src="./js/formulario.js"></script>
    <script src="./js/painel.js"></script>
    
    <style>
        .footer {
            background: var(--primary);
            color: white;
            text-align: center;
            padding: 1.5rem;
            margin-top: auto;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .painel-controls {
            margin-bottom: 1rem;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th,
        .table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .text-center {
            text-align: center;
        }
        
        /* Email Notification */
        .email-notification {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1.5rem 0;
            box-shadow: 0 2px 4px rgba(33, 150, 243, 0.1);
        }
        
        .email-notification-content {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .email-icon {
            font-size: 1.5rem;
            color: #2196f3;
            margin-top: 0.25rem;
        }
        
        .email-text {
            flex: 1;
        }
        
        .email-text strong {
            color: #1976d2;
            font-size: 1rem;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .email-text p {
            margin: 0;
            color: #424242;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        @media (max-width: 768px) {
            .email-notification {
                padding: 0.75rem;
            }
            
            .email-notification-content {
                gap: 0.75rem;
            }
            
            .email-icon {
                font-size: 1.25rem;
            }
        }
    </style>
    
    <script>
        function toggleOutroSolicitante() {
            const select = document.getElementById('solicitante');
            const campoOutro = document.getElementById('campo-outro-solicitante');
            const inputOutro = document.getElementById('outro-solicitante');
            
            if (select.value === 'Outros (especificar)') {
                campoOutro.style.display = 'block';
                inputOutro.required = true;
            } else {
                campoOutro.style.display = 'none';
                inputOutro.required = false;
                inputOutro.value = '';
            }
        }
        
        function testarNavegacaoDireta() {
            console.log('🧪 Testando navegação direta...');
            
            // Verificar se elementos existem
            const formulario = document.getElementById('formulario');
            const painel = document.getElementById('painel');
            const dashboard = document.getElementById('dashboard');
            
            console.log('📄 Formulário encontrado:', !!formulario);
            console.log('📄 Painel encontrado:', !!painel);
            console.log('📄 Dashboard encontrado:', !!dashboard);
            
            // Verificar funções
            console.log('🔧 showPainel:', typeof showPainel);
            console.log('🔧 switchPage:', typeof switchPage);
            
            // Método 1: Usar switchPage diretamente
            console.log('🔄 Tentativa 1: switchPage("painel")');
            if (typeof switchPage === 'function') {
                try {
                    switchPage('painel');
                    console.log('✅ switchPage executado sem erro');
                } catch (error) {
                    console.error('❌ Erro no switchPage:', error);
                }
            } else {
                console.log('❌ switchPage não é uma função');
            }
            
            // Método 2: Navegação manual como fallback
            setTimeout(() => {
                console.log('🔄 Tentativa 2: navegação manual');
                
                if (formulario && painel) {
                    // Esconder formulário
                    formulario.classList.add('d-none');
                    formulario.style.display = 'none';
                    console.log('🔒 Formulário escondido');
                    
                    // Mostrar painel
                    painel.classList.remove('d-none');
                    painel.style.display = 'block';
                    console.log('✅ Painel mostrado');
                    
                    // Ativar botão
                    const buttons = document.querySelectorAll('.nav-button');
                    buttons.forEach(btn => btn.classList.remove('active'));
                    if (buttons[1]) {
                        buttons[1].classList.add('active');
                        console.log('✅ Botão do painel ativado');
                    }
                    
                    // Verificar resultado
                    setTimeout(() => {
                        const painelStyle = window.getComputedStyle(painel);
                        console.log('🔍 Resultado final - Painel display:', painelStyle.display);
                        console.log('🔍 Resultado final - Painel visibility:', painelStyle.visibility);
                        console.log('🔍 Resultado final - Painel classes:', painel.className);
                    }, 100);
                } else {
                    console.error('❌ Elementos não encontrados para navegação manual');
                }
            }, 1000);
        }
        
        function limparFormulario() {
            const form = document.getElementById('form-solicitacao');
            if (form) {
                form.reset();
                const campoOutro = document.getElementById('campo-outro-solicitante');
                if (campoOutro) {
                    campoOutro.style.display = 'none';
                }
            }
        }
    </script>
</body>
</html>
